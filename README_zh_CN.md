# GCServer

> **GameCenter **是 [@LTCat](https://github.com/LTCatt) 所写的一个游戏平台，他本人已经弃坑，目前只完成了小游戏**《你说我猜》**。
>
> 其客户端使用 [*VB.Net*](https://en.wikipedia.org/wiki/Visual_Basic_.NET) 编写，为后续反编译做出了不可磨灭的贡献。

**服务端仍在 `开发 & Debug` 中，将于最基本的`API`封装完成后`push`至本项目。**



## 简介

由于 [@LTCat](https://github.com/LTCatt) 没有开源 GameCenter 的计划，本项目是通过反编译其代码，了解原协议后完成的。

在观察反编译代码过程中，发现了一些原服务端存在的漏洞，主要原因是过于信任客户端。发现的漏洞均已在本服务端中修复。



## 通信过程

> 本内容将在服务端封装完善后作为`服务端插件开发指南`搬到项目Wiki。

阅读代码后，发现客户端与服务端之间的通信是靠 `Socket` 实现的。

由于 `TCP` 是一个基于`流` 的协议 ，通信过程中会发生 `粘包` 问题，原协议通过在信息中加入`¨ (U+00A8)` 来对通信指令进行分割，本项目为了兼容原客户端，继续使用了该符号作为分隔符。



### 客户端

##### 0. 连接

  * 客户端通过 Socket 向服务端发起连接

##### 1. 接收房间列表

  * 此时客户端应收到类似 `Center|roomA|roomB|etc...` 的房间列表数据，

  * 通过 `|` 分割后就能得到包含房间名的列表了

##### 2. 创建房间 ǁ 加入房间

* ##### 创建

  * ###### 在原通信协议中

    * 并没有规定 *创建房间* 时该如何发送房间信息（ `如房间名，房间游戏类型等`）

    * 反之，客户端只需要发送 `Create` 。

  * ######  显而易见，这是不合理的

    * 玩家应可以通过客户端决定自己房间的 `名称，人数限制，游戏类型` 等参数。

    * 为了兼容原版服务端，目前服务端中只通过 *指令* 提供了相应的操作。

* ##### 加入
  * ###### 在原通信协议中
    - 如果客户端想加入一个房间，它只会发送 `Join|`+`房间 Index`
    
      > 举例：
      > 	当前房间列表：[roomA,roomB,roomC]
      > 	如果玩家选中了"roomC",客户端应该发送"Join|2"

    - 因为传递的是当前房间列表的下标，如果由于延迟导致的更新不及时，甚至有可能加错房间。

  * ###### 显而易见，这还是不合理的
    * 房间应该有一个随机生成的UUID，在加入时发送 `Join|UUID` ，目前项目中还没有实现。

##### 3. 聊天

* 发送
  
  * 很简单，你只需要向服务器发送 `Chat|`+`信息`。
  * 自己发的消息不需要直接输出到聊天窗口。
* 接收
  * 你会收到 `Chat|`+`信息`+`|0` 或 `Chat|`+`信息`+`|1`，最后的数字代表了这条信息是否要加粗，关于发送者之类的，已经包含在信息里由服务器加工好了。
  
    > 举例：
    > 	收到 "Chat|ck:Mikoto!|0"
    > 	此时客户端应显示 "ck:Mikoto!"(未加粗)
  
  这个倒是没啥问题，但如果使用json，后期增加新玩法需要特殊消息的时候会方便一些。为了兼容原版，本项目还未做出相应调整。

##### 4. 等待开始

* 玩家
    * 准备：发送 `Prepare|True` 
    * 取消准备：发送 `Prepare|False` 
* 房主
    * 收到 `Start|1` 后允许 `开始游戏`
    * 收到 `Start|0` 后禁用 `开始游戏`



#####  5. 游戏开始

  根据不同的游戏类型进行兼容，需与服务端协同好API。



> 编写中...

---

#### 服务端
> 编写中...
